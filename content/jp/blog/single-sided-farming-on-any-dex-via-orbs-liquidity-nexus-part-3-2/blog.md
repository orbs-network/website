---
layout: partials/shared/mappers/blog-mapper
image: /assets/img/blog/single-sided-farming-on-any-dex-via-orbs-liquidity-nexus-part-3-2/bg.jpeg
blogUrl: single-sided-farming-on-any-dex-via-orbs-liquidity-nexus-part-3-2
date: 2021-05-01
title: OrbsによるDEX接続 シングルサイド・ファーミング リクイディティ Nexus — パート ３
author:
  - /jp/blog/common/authors/TalKol.md
type:
short_description: ### [Orbs Liquidity Nexus](https://www.orbs.com/jp/orbs-%e3%83%aa%e3%82%af%e3%82%a4%e3%83%87%e3%82%a3%e3%83%86%e3%82%a3nexus%e3%81%ae%e7%b4%b9%e4%bb%8b-%e6%b5%81%e5%8b%95%e6%80%a7%e4%be%9b%e7%b5%a6%e3%82%b5%e3%83%bc%e3%83%93%e3%82%b9/)は、CeFiから来る流動性をDeFiに導入します。
---

### [Orbs Liquidity Nexus](https://www.orbs.com/jp/orbs-%e3%83%aa%e3%82%af%e3%82%a4%e3%83%87%e3%82%a3%e3%83%86%e3%82%a3nexus%e3%81%ae%e7%b4%b9%e4%bb%8b-%e6%b5%81%e5%8b%95%e6%80%a7%e4%be%9b%e7%b5%a6%e3%82%b5%e3%83%bc%e3%83%93%e3%82%b9/)は、CeFi から来る流動性を DeFi に導入します。

最近では、SushiSwap や PancakeSwap などの、DEX での取引が増え、ETH/USDC や BNB/BUSD といった人気のあるプールが選ばれています。

CeFi 資本は、価格の安定した USDC や BUSD を提供します。DeFi 資本は、ETH や BNB といった暗号通貨を提供します。ここからは、それらを合わせたファーミングの世界をお見せします。

[Nexus パート１](https://www.orbs.com/jp/orbs%E3%81%AB%E3%82%88%E3%82%8Bdex%E6%8E%A5%E7%B6%9A-%E3%82%B7%E3%83%B3%E3%82%B0%E3%83%AB%E3%82%B5%E3%82%A4%E3%83%89%E3%83%BB%E3%83%95%E3%82%A1%E3%83%BC%E3%83%9F%E3%83%B3%E3%82%B0-%E3%83%AA%E3%82%AF/)、[パート２](https://www.orbs.com/jp/orbs%e3%81%ab%e3%82%88%e3%82%8bdex%e6%8e%a5%e7%b6%9a-%e3%82%b7%e3%83%b3%e3%82%b0%e3%83%ab%e3%82%b5%e3%82%a4%e3%83%89%e3%83%bb%e3%83%95%e3%82%a1%e3%83%bc%e3%83%9f%e3%83%b3%e3%82%b0-%e3%83%aa%e3%82%af-2/)はこちらよりご覧ください

...

## ボールトを利用した従来のダブルサイド・ファーミング

DeFi のボールトのコンセプトは、[Andre Cronje](https://twitter.com/AndreCronjeTech)氏が[yearn.finance](https://yearn.finance/vaults)を通じて広めたもので、DeFi コミュニティで瞬く間にヒットしました。アイデアはシンプルで、複数のファーマーが一緒に流動性を供給できるようにして、スマート・コントラクトで自動的にポジションを管理し、複利（毎日の報酬を受け取り、ベースとなる流動性資産に売り戻し、ポジションを増やして複利を発生させる）などのアクションでイールド効率を上げるというものです。

その後の注目すべきボールト・プロジェクトは、全トークン・エコノミーでこのアイデアを広めた[harvest.Finance](https://harvest.finance/)です。Harvest のステーキングで得られる FARM は、ファーミング利益の 30%を手数料として取りますが、[FARM](https://www.coingecko.com/en/coins/harvest-finance)をステーキングしておくことで、基本的な利回りにプラスしてリワードが分配され、より多くのファーマーに参加してもらうインセンティブとなり、トータルの APY を増加させています。

BSC でも、アグリゲート・イールド・ファーミングのボールトに人気があり、この記事を書いている時点で、15 億ドルを超える驚異的な TVL（預かり資産）を持つ、業界トップの[acryptos](https://acryptos.com/)や[autofarm.network](https://autofarm.network/)などのプロジェクトが注目されています。

では、従来のダブルサイド・ファーミングのヴォールトとはどのようなものでしょうか？Uniswap/SushiSwap/1inch で、ETH/USDC のリクイディティ・リワードをファーミングしているものから、ひとつ例を取り上げてみましょう。

![](/assets/img/blog/single-sided-farming-on-any-dex-via-orbs-liquidity-nexus-part-3-2/1_3UFPBgNSAyhMr9_rkrqrdA-1030x434.png)

1. DeFi(タイプ A)プレイヤーは、ETH と USDC をボールト・コントラクト、例えば harvest.finance などに預けます。多くの場合、ヴォールトとしては、技術的に LP トークンを預けてもらうことをユーザーに希望しますが、この 2 つは交換可能です。
2. ボールトのコントラクトは、LP トークンと引き換えに、ETH/USDC を DEX のペア・コントラクト（[SushiSwap](https://etherscan.io/address/0x397ff1542f962076d0bfe58ea045ffa2d347aca0)など）に預けます。
3. LP トークンは、LP ファーミング・リワード・コントラクト（Sushi's [Masterchef](https://en.wikipedia.org/wiki/MasterChef)など）に預けられ、SUSHI リワードの獲得を開始します。
4. 定期的に、ボールトは SUSHI リワードを請求し、ETH/USDC で売却し、ステップ 2 に戻ります。

## Orbs リクイディティ Nexus での

## シングルサイド・ファーミング

この Nexus についての連載で目指してきたのは「シングルサイド・ファーミング」です。このコンセプトを関連するターゲット層に紹介する方法の一つとして、ヴォールトが考えられます。ヴォールトはタイプ A の参加者を対象としているため（タイプ A ＝クリプト愛好家たち、定義については過去記事参照）、ボールトは ETH 側のみを表現します。

もう一方の、この例では USDC 側は、タイプ B（従来の金融業界の人々）の参加者が提供します。タイプ B の参加者は、DeFi 界へ顔をだすことはあまりないので、リクイディティ Nexus が両者の橋渡しをすることになります。

ではそれはどのようなものでしょうか？

![](/assets/img/blog/single-sided-farming-on-any-dex-via-orbs-liquidity-nexus-part-3-2/1_fu-3x-EspMc46G2XFGsBcg-1030x466.png)

1. DeFi（タイプ A）のプレイヤーは，ETH をボールトのコントラクトに預けます。これはもちろん ETH のみを扱う新しいボールトでなければならず、harvest.finance のような既存のボールト・プロジェクトの一つに貢献し、そのガバナンスに受け入れられなければなりません。
2. CeFi（タイプ B）プレイヤーは、リクイディティ Nexus のプロトコルを使って USDC を Nexus コントラクトに預けます。この部分がシングルサイド・ファーミングを可能にし、前回の記事で説明したロジックを実行します。
3. ETH ボールトのコントラクト・ペアは、新しく入金された ETH と Nexus contract で待機している利用可能な USDC をペアにします。この ETH/USDC の同価値のペアは、Nexus コントラクトによって DEX ペア・コントラクト（SushiSwap など）、に預けられ、LP トークンと交換されます。
4. LP トークンは、LP ファーミング・リワード・コントラクト、（Sushi's Masterchef など）に預けられ、SUSHI リワードの獲得を開始します。
5. 定期的に、ETH ボールトが Nexus コントラクトを通じて SUSHI リワードを請求し、ETH で売却し、ステップ 3 に戻ります。

## ETH オンリーのボールトは数が少なく魅力的

DeFi をご利用になったことのある方は、ETH のみのファーミングが一般的ではないことをご存知でしょう。見つかったとしても、たいていは低い APY を提供しています。この図は、現在の harvest.finance の ETH のみのリワード戦略です。

![](/assets/img/blog/single-sided-farming-on-any-dex-via-orbs-liquidity-nexus-part-3-2/1_FQvFQmvCa_JM7SP_qKfJiA-1030x447.png)

ご覧の通り、このボールト内の APY はかなり低く、0.41％しかありません（残りはファーム・リワードの参加インセンティブです）。このボールトが採用しているシンプルな戦略は、ETH を担保として[Compound](https://compound.finance/)に供給し、供給利子と COMP リワードの両方を得るというものです。このことから、ETH レンディングの APY は比較的低いということがわかります。

リクイディティ Nexus プロトコルについてお話しすると、はるかに高い APY を生成する、ETH だけを使う新しいタイプの戦略を開発することができます。APY は、ETH/USDC のダブルサイド・ファーミングを Sushi で行うよりもさらに高くなるはずです。理由を説明します。Orbs のシングルサイドのトークン・エコノミクスは、ETH 側のリワードに有利に働きます。IL のリスクをより多く取ることと引き換えに、ETH 側に半分以上のリワードを与えるからです。この点については、Nexus ブログシリーズのパート１、２をご参照ください。

Harvest.Finance のような既存のボールト・プロジェクトにとって、ユーザーのために最高の APY を追求することがそのままプロジェクトの収入源となっているため、このことは非常に魅力的です。

また、タイプ A の DeFi プレイヤーにとっても、この結果は非常に魅力的です。なぜなら、このシングルサイドでの戦略は、クリプト慣れした側にいる人々が、たいていの場合、大量に保有している暗号資産（ETH）で参加できるので、同額の USDC を購入するという煩わしいバランス調整を必要としないからです。

最後に、タイプ B の CeFi プレイヤーにとっても、この結果は非常に魅力的です。なぜなら、シングルサイドの戦略は USDC のみで参加できるので、暗号資産のボラティリティのリスクを最小限に抑えることができるからです。

## どの DEX にも適用可能

Nexus のもう一つの利点は、ベースとして利用する DEX に、何も変更をする必要がないことです。この方法では、すでに使われてるバージョンの Uniswap、SushiSwap、1inch、PancakeSwap やその他の DEX を、すぐにサポートすることができます。

## 実装について

アーキテクチャが明確になったところで、いよいよ実装に入ります。上の手書きの図、四角で囲んだ黄色の部分に、リクイディティ Nexus のコントラクトを実装していきます。

[rekt のリーダーボード](https://rekt.news/leaderboard/)が示しているように、ボールトにはデリケートな問題もあります。成功しているボールトは、数億ドルから数十億ドルの資産管理をしているため、ハッカーの格好のターゲットとなります。

これまでの経験から、悪用されるケースは大きく分けて 2 種類あります。

- 経済的な攻撃 - コードがどの言語で実装されているかに関わらず、ロジカルな問題に起因。例えば、フラッシュローンを利用して harvest.finance の USDC と USDT のボールトから[2,500 万ドルを盗み出した](https://rekt.news/harvest-finance-rekt/)悪名高い事件があります。
- 実装への攻撃 - コントラクトの記述に使用される特定の言語の仮想マシンやコンパイラの実装上のニュアンスに起因する問題。ほとんどのコントラクトは Solidity で書かれていますが、Solidity には様々な[既知の攻撃](https://consensys.github.io/smart-contract-best-practices/known_attacks/)があります。

最近では、前者のタイプの方が成功しているようです。開発の過程で技術的追求に重きを置き、経済的メリットを盲点にしがちです。そこで、これに対抗するために、実装の第一ステップとして経済シミュレーションを行ってみることをお勧めします。

## フェーズ１：経済シミュレーション

Github repo はこちらからご覧になれます here:[https://github.com/defi-org-code/single-playground](https://github.com/defi-org-code/single-playground)

成功するシミュレーションとは？まず第一に、ラピッド・プロトタイピングです。シミュレーションを書くことは、実際のものを書くよりも簡単で速くなければなりません。私たちはロジックだけに集中したいので、どんな言語でも良いと思います。Solidity のような厳格で安全な言語に頼るのは、その防御的な性質のために開発が遅くなるので、あまり意味がありません。細かいことは気にせず、全体像を見渡せるような言語が必要です。

そんなときに思い浮かぶのが JavaScript です。

シミュレーションの第二の課題は、周囲の世界をモデル化することです。上の図の黄色の部分（リクイディティ Nexus のコントラクト）を実装するためには、他のすべてのものをモックアップする必要があります。これは複雑な作業のように聞こえますが、実際にはそうではありません。例えば、Sushi を例に挙げてみましょう。Sushi をすべて正確に実装する必要はなく、大まかな動作で構いません。

そこで、Sushi を短くシミュレートしたバージョン、[sushi.js](https://github.com/defi-org-code/single-playground/blob/master/sushi.js)を考えてみましょう。

シミュレーションは、開発者がさまざまな攻撃を防御するための便利な試しツールです。注意すべき点として、フラッシュローンを挙げました。しかし、今回のケースでは、攻撃者はフラッシュローンを何に使うのでしょうか？Sushi ETH/USDC プールで ETH の価格を一時的に操作するための手段として使われるでしょう。フラッシュローンのモデル化に数時間を費やすのではなく、今回のシミュレーションを利用して、もっと単純な方法で ETH 価格を直接変更する方法を攻撃者に与えてみましょう。これにより、自動化されたテストで攻撃経路を簡単にモデル化することができます。

このレポは次のように 3 つの部分に分かれ、それぞれ興味深い内容となっています。

１．[master](https://github.com/defi-org-code/single-playground/tree/master) ： 従来のシンプルなダブルサイド・ボールトの実装（シングルサイドの複雑さがないコントロールグループ）。

２．[crazy-idea1](https://github.com/defi-org-code/single-playground/tree/crazy-idea1) ： ERC20 互換のボールト・シェアに基づくシングルサイド・ボールトで、ETH 預金者全員が一緒に IL を共有します。このアプローチは、テストで示されているように、経済的に利用することができます。

３．[no-shares](https://github.com/defi-org-code/single-playground/tree/no-shares) ： ETH 預金者間の IL を分離する、より優れたシングルサイド・ボールトの実装。簡単な方法ではありますが、ERC20 トークン間の相互性が難しいのが欠点で、これについては、今後の投稿で詳しく説明します。

これらのシミュレーションを行った結果、興味深いことが色々とありました。これらについては、経緯や詳細な説明が必要なので、別の記事で紹介したいと思います。

## フェーズ２： Solidity の導入

Github repo はこちらからご覧になれます。[https://github.com/orbs-network/nexus-sushiswap](https://github.com/orbs-network/nexus-sushiswap)

経済シミュレーションを見終わったところで、フェーズ 1 の結果から、経済に対する理解が深まり、コントラクト・ロジックの仕様が明らかになりました。

次のフェーズでは、このロジックを Solidity に実装していきます。このプロセスは、Solidity のコードを急ぐ必要がないため、少しゆっくりとしたものになります。これは大きな金額を管理するプロダクション・コードになりますので、防御的なコーディング・スタイルを推奨します。

この段階では、[SushiSwap ETH/USDC ペア](https://etherscan.io/address/0x397FF1542f962076d0BFE58eA045FfA2d347ACa0)のように、私達が使うすべてのサードパーティ・コントラクトのメインネットの実装ができるので、外部との統合がより簡単になります。つまり、テストのためにモックを作る必要がないのです。

Ethereum メインネットで直接テストを行う段階になると、少し面倒になります。テスト・シナリオの実装には手間がかかるかもしれませんが、コントラクトが実際にメインネットにデプロイされた場合の運用状況にできるだけ近い形で、本物をテストしているという利点があります。これは、Ganache（Truffle のプロダクト）の素晴らしいメインネット・フォーク機能によるもので、[Hardhat 上でも](https://hardhat.org/guides/mainnet-forking.html)簡単に有効化することができます。

私たちのチームは、E2E テストにこだわりを持っています。テストをパスすること以上に、コードの動作を証明する方法はありません。

例えばこのテストでは、（前回のブログで定義した）戦略 1 を使うと、ETH の価格が動いたとしても、USDC を供給する側では、最初に預けた USDC と同じ量の USDC を引き出すことができます。

![](/assets/img/blog/single-sided-farming-on-any-dex-via-orbs-liquidity-nexus-part-3-2/1_UDA84-Qw1cMNPjseCwJCKA-1030x457.png)

見る方が見れば、「ETH 価格の変更」がこのフェーズでどのように動作するのか疑問に思われるかもしれません。なぜなら、シミュレーションのように簡単には実装できないからです。実際には、価格が希望の金額になるまで何度もスワップを繰り返すというハードな作業となります。その様子は[こちら](https://github.com/orbs-network/nexus-sushiswap/blob/ffd6931e51ef077a1a021e53cd8d3de7f61cfe7b/test/test-base.ts#L102)でご覧いただけます。

## 詳細について

私たちの取り組みに興味をお持ちいただき、公開前の開発中の段階をご覧になりたい場合は、Github で Orbs をフォローしてください。

- https//github.com/orbs-network — Github の Orbs プロジェクト
- https://github.com/defi-org-code — DeFi.org Accelerator イノベーションラボ（アイデアは初めにここから生まれます）

...

備考:

このブログでは、Orbs チームとエコシステムのコントリビュータが、現在研究しているプロジェクトの詳細を説明しています。このプロジェクトは現在、コンセプトモードであり、Orbs チームが現在想定しているものを紹介しています。

Orbs は、コミュニティの貢献とガイダンスによって推進される分散型のプロジェクトです。したがって、本ブログに記載されている製品や機能は、コミュニティからのフィードバックに基づいて作成された提案にすぎず、新しい要件の発生により継続的に変更される可能性があります。本ブログは、いかなるサービス、製品、または特定の機能が完全または部分的に開発されることを保証するものではありません。

本ブログに記載された情報は、いかなる管轄区域においても何かを確約するものではなく、そして根拠またそれに依拠するものでもありません。
